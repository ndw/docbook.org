<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>DocBook Transclusion</title><meta name="generator" content="DocBook XSL Stylesheets V1.77.0-pre"><link rel="stylesheet" type="text/css" href="http://docbook.org/docs/howto/howto.css"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="article" title="DocBook Transclusion"><div class="titlepage"><h1>DocBook Transclusion</h1><h3>20&nbsp;April&nbsp;2011</h3><div class="metadata"><h4>This version:</h4><dl class="urilist"><dt><span>http://docbook.org/docs/transclusion/2011-04-20/</span> (<a href="http://docbook.org/docs/transclusion/2011-04-20/">HTML</a>, <a href="http://docbook.org/docs/transclusion/2011-04-20/transclusion.xml">XML</a>, <a href="http://docbook.org/docs/transclusion/2011-04-20/transclusion.pdf">PDF</a>)</dt></dl><h4>Latest version:</h4><dl class="urilist"><dt><span>http://docbook.org/docs/transclusion/</span> (<a href="http://docbook.org/docs/transclusion/">HTML</a>, <a href="http://docbook.org/docs/transclusion/transclusion.xml">XML</a>, <a href="http://docbook.org/docs/transclusion/transclusion.pdf">PDF</a>)</dt></dl><h4>Previous version:</h4><dl class="urilist"><dt><span>http://docbook.org/docs/transclusion/2010-12-09/</span> (<a href="http://docbook.org/docs/transclusion/2010-12-09/">HTML</a>, <a href="http://docbook.org/docs/transclusion/2010-12-09/transclusion.xml">XML</a>, <a href="http://docbook.org/docs/transclusion/2010-12-09/transclusion.pdf">PDF</a>)</dt></dl><h4>Author:</h4><dl class="authorlist"><dt><span class="personname"><span class="firstname">Jirka</span> <span class="surname">Kosek</span></span>, <code class="email">&lt;<a class="email" href="mailto:jirka@kosek.cz">jirka@kosek.cz</a>&gt;</code></dt></dl></div><hr></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="#d6e20">Inline reference</a></span></dt><dt><span class="section"><a href="#d6e145">External references</a></span></dt><dt><span class="section"><a href="#d6e180">Special ID/IDREF processing</a></span></dt><dt><span class="section"><a href="#d6e343">Transformations</a></span></dt><dt><span class="section"><a href="#d6e347">Evaluation</a></span></dt><dt><span class="appendix"><a href="#d6e353">A. DocBook schema with support for transclusions</a></span></dt><dt><span class="appendix"><a href="#d6e362">B. Sample transclusion processor written in XSLT 2.0</a></span></dt><dt><span class="appendix"><a href="#d6e368">C. Mapping Transclusions to XInclude</a></span></dt><dt><span class="appendix"><a href="#d6e445">D. Alternative proposal from Hussein Shafie</a></span></dt></dl></div>
  



<p>This document describes syntax, semantics and processing model
of DocBook transclusion mechanism. Please be aware that this is early
stage draft &#8211; everything described below might change or disappear
completely. This proposal tries to resolve <a class="ulink" href="http://docbook.org/docs/transclusion-requirements/" target="_top"><em class="citetitle">Requirements
for transclusion in DocBook</em></a>.  DocBook TC welcomes any
feedback on this draft, especially from users and developers of
DocBook authoring and processing tools. Plese direct your comments to
DocBook mailing list by sending email to
<code class="email">&lt;<a class="email" href="mailto:docbook@lists.oasis-open.org">docbook@lists.oasis-open.org</a>&gt;</code>.</p>

<p class="remark"><em><span class="remark">Actually, for now the document is written more like
tutorial. If DocBook TC decides to incorporate this into DocBook, more
formal and precise specification will follow.</span></em></p>

<p>Transclusion in documents is described by <code class="sgmltag-element">ref</code> element
which references the content to transclude. There are two basic types of
reference &#8211; inline and external. Inline references reference content
which is defined in some other place using the <code class="sgmltag-element">definitions</code>
element. An external reference references some external content which
might or might not be written using DocBook vocabulary.</p>

<div class="section" title="Inline reference"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d6e20"></a>Inline reference</h2></div></div></div>


<p>An inline reference is denoted by the <code class="sgmltag-element">ref</code> element
with a mandatory <code class="sgmltag-attribute">name</code> attribute which
contains the name of referenced content. This name is case-sensitive
and the document must contain a definition of the referenced content
in the <code class="sgmltag-element">definitions</code> element.</p>

<div class="example"><a name="d6e26"></a><p class="title"><b>Example&nbsp;1.&nbsp;Simple usage of inline references and defintions</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>3.14<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>ACME Inc.<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>The result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong> from ACME Inc. is 3.14.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
</div></div><br class="example-break">

<p>The definition can contain arbitrary markup, not just text. All child
nodes of the <code class="sgmltag-element">def</code> element are transcluded by corresponding
<code class="sgmltag-element">ref</code> element.</p>

<div class="example"><a name="d6e38"></a><p class="title"><b>Example&nbsp;2.&nbsp;An inline definition with nested markup</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;author&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"jirka"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/author&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"jirka"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;personname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;firstname&gt;</strong>Jirka<strong class="hl-tag" style="color: #000096">&lt;/firstname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;surname&gt;</strong>Kosek<strong class="hl-tag" style="color: #000096">&lt;/surname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/personname&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This article was written by <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"jirka"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> when there was 25C outside.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;author&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;personname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;firstname&gt;</strong>Jirka<strong class="hl-tag" style="color: #000096">&lt;/firstname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;surname&gt;</strong>Kosek<strong class="hl-tag" style="color: #000096">&lt;/surname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/personname&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/author&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This article was written by 
        <strong class="hl-tag" style="color: #000096">&lt;personname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;firstname&gt;</strong>Jirka<strong class="hl-tag" style="color: #000096">&lt;/firstname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;surname&gt;</strong>Kosek<strong class="hl-tag" style="color: #000096">&lt;/surname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/personname&gt;</strong>
       when there was 25C outside.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
</pre>
</div></div><br class="example-break">

<p>Definitions can be placed directly inside an <code class="sgmltag-element">info</code>
element or they can be stored in a separate file which can be
referenced by multiple documents.</p>

<div class="example"><a name="d6e49"></a><p class="title"><b>Example&nbsp;3.&nbsp;Definitions stored in a separate document (<code class="filename">definitions.001.xml</code>)</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;definitions</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>3.14<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>ACME Inc.<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>

</pre>
</div></div><br class="example-break">

<div class="example"><a name="d6e55"></a><p class="title"><b>Example&nbsp;4.&nbsp;Usage of definitions stored in a separate document</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <em class="hl-comment" style="color: silver">&lt;!-- Definitions are loaded from external file --&gt;</em>
    <strong class="hl-tag" style="color: #000096">&lt;definitions</strong> <span class="hl-attribute" style="color: #F5844C">definitionfile</span>=<span class="hl-value" style="color: #993300">"definitions.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>    
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from ACME Inc. is 3.14.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
</pre>
</div></div><br class="example-break">

<p>Definitions from external file can be locally redefined.</p>

<div class="example"><a name="d6e65"></a><p class="title"><b>Example&nbsp;5.&nbsp;Redefinition of definition provided in an external file</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;definitions</strong> <span class="hl-attribute" style="color: #F5844C">definitionfile</span>=<span class="hl-value" style="color: #993300">"definitions.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <em class="hl-comment" style="color: silver">&lt;!-- Local definition will override definition from external definitions file --&gt;</em>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>4.01<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>    
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from ACME Inc. is 4.01.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
</pre>
</div></div><br class="example-break">

<p>Definitions can be conditional. All effectivity attributes can
be used to set conditions on definitions.</p>

<p class="remark"><em><span class="remark">Gershon: I'd like to see examples 14 and 15 be followed by
a more complex exmaple that demonstrates the different result
depending on processing order, so that we can also determine which
order should be normative and correct per the DocBook spec.</span></em></p>

<div class="example"><a name="d6e76"></a><p class="title"><b>Example&nbsp;6.&nbsp;Conditional definitions</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>3.14<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <em class="hl-comment" style="color: silver">&lt;!-- Conditional definitions --&gt;</em>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span> <span class="hl-attribute" style="color: #F5844C">os</span>=<span class="hl-value" style="color: #993300">"win"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Windows Protector<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span> <span class="hl-attribute" style="color: #F5844C">os</span>=<span class="hl-value" style="color: #993300">"linux"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Linux Protector<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>ACME Inc.<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>Linux Protector<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from ACME Inc. is 3.14.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
</pre>
</div></div><br class="example-break">

<p>Effectivity attributes can be also used on references itself.</p>

<div class="example"><a name="d6e86"></a><p class="title"><b>Example&nbsp;7.&nbsp;Conditional references</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>3.14<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>      
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name-win"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Windows Protector<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name-lin"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Linux Protector<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>ACME Inc.<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of
    <em class="hl-comment" style="color: silver">&lt;!-- Conditional references --&gt;</em>    
    <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">os</span>=<span class="hl-value" style="color: #993300">"win"</span> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name-win"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">os</span>=<span class="hl-value" style="color: #993300">"linux"</span> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name-lin"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
    from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
</div></div><br class="example-break">

<p>Definitions are valid only in the subtree rooted at the parent of
<code class="sgmltag-element">info</code> element containing definitions.</p>

<div class="example"><a name="d6e93"></a><p class="title"><b>Example&nbsp;8.&nbsp;Scope of defintions</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> company product guide<b style="color: navy">&lt;/title&gt;</b>
    <em class="hl-comment" style="color: silver">&lt;!-- Multiple definitions in single document --&gt;</em>
    <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>ACME Inc.<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;article&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> Guide<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>3.14<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
      from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;article&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> Guide<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;definitions&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>4.2<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;def</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Knit-o-Matic<strong class="hl-tag" style="color: #000096">&lt;/def&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/definitions&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
      from <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> is <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"product-version"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>ACME Inc. company product guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;article&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>FooWiz Guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>FooWiz<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
      from ACME Inc. is 3.14.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;article&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Knit-o-Matic Guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>The latest version of <strong class="hl-tag" style="color: #000096">&lt;application&gt;</strong>Knit-o-Matic<strong class="hl-tag" style="color: #000096">&lt;/application&gt;</strong>
      from ACME Inc. is 4.2.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>
</pre>
</div></div><br class="example-break">

<p>A reference can point to particular external definitions file not to
all in-scope definitions.</p>

<div class="example"><a name="d6e103"></a><p class="title"><b>Example&nbsp;9.&nbsp;Reference to particular definition file</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This is article about history of <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">definitionfile</span>=<span class="hl-value" style="color: #993300">"definitions.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"corp-name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This is article about history of ACME Inc..<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
</pre>
</div></div><br class="example-break">

<div class="procedure" title="Procedure&nbsp;1.&nbsp;Finding the reference definition for ref element with just name attribute"><a name="d6e112"></a><p class="title"><b>Procedure&nbsp;1.&nbsp;Finding the reference definition for <code class="sgmltag-element">ref</code> element with
just <code class="sgmltag-attribute">name</code> attribute</b></p><ol class="procedure" type="1"><li class="step" title="Step 1">
<p>A transclusion processor implementation might provide a mechanism
for overriding any definition. This mechanism is used first when finding
a definition for a reference.</p>
</li><li class="step" title="Step 2"><a name="ref-resolution-s2"></a>
<p>The closest element containing
<code class="literal">info/definitions</code> is found on
the ancestor-or-self:: XPath axis.</p>
<ol type="a" class="substeps">
<li class="step" title="Step 2.a"><p>If <code class="sgmltag-element">definitions</code> contains <code class="sgmltag-attribute">definitionfile</code> attribute then content of referenced file is
treated as if it was inserted before the respective
<code class="sgmltag-element">definitions</code> element.</p></li>
<li class="step" title="Step 2.b"><p>If there are multiple matching
<code class="literal">info/definitions/def</code> elements then the last one is
used. If there is no matching definition then we continue with <a class="xref" href="#ref-resolution-s2" title="Step 2">Step 2</a>.</p></li>
</ol>
</li><li class="step" title="Step 3"><p>If no matching definition was find so far, an error is raised.</p></li></ol></div>

<div class="procedure" title="Procedure&nbsp;2.&nbsp;Finding reference definition for ref element with definitionfile attribute"><a name="d6e133"></a><p class="title"><b>Procedure&nbsp;2.&nbsp;Finding reference definition for <code class="sgmltag-element">ref</code> element with
<code class="sgmltag-attribute">definitionfile</code> attribute</b></p><ol class="procedure" type="1"><li class="step" title="Step 1">
<p>Referenced definition file is searched for definition
(<code class="sgmltag-element">def</code> element with matching value in a <code class="sgmltag-attribute">name</code> attribute).</p>
<em><span class="remark">Should be <span class="attribute">definitionfile</span>
attribute supported here for chaining of definitions? Probably yes.</span></em>
</li><li class="step" title="Step 2"><p>If no matching definition is found, error is raised.</p></li></ol></div>

</div>

<div class="section" title="External references"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d6e145"></a>External references</h2></div></div></div>


<p>An external reference is denoted by the <code class="sgmltag-element">ref</code> element with
a mandatory <code class="sgmltag-attribute">fileref</code> attribute which
contains URI of referenced document. The reference is replaced with
content of referenced document. The outermost transcluded element is
augmented with <code class="sgmltag-attribute">xml:base</code> attribute in
order to retain relative references.</p>

<div class="example"><a name="d6e151"></a><p class="title"><b>Example&nbsp;10.&nbsp;External reference</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"art-1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Sample article<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Leading text<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"module.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Sample article<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Leading text<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;section</strong> <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/module.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Module which is going to be shared across several documents<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Bla bla bla<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/section&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>

</pre>
</div></div><br class="example-break">

<p>It is possible to specify additional attributes <code class="sgmltag-attribute">xpointer</code>, <code class="sgmltag-attribute">parse</code>
and <code class="sgmltag-attribute">encoding</code> &#8211; their meaning is identical
to corresponding attributes from <a class="ulink" href="http://www.w3.org/TR/xinclude/" target="_top">XInclude</a>.</p>

<p>Please note that while process similar to XInclude <a class="ulink" href="http://www.w3.org/TR/xinclude/#base" target="_top">Base URI Fixup</a>
is performed, <a class="ulink" href="http://www.w3.org/TR/xinclude/#language" target="_top">Language
Fixup</a> is not performed.<sup>[<a name="d6e168" href="#ftn.d6e168" class="footnote">1</a>]</sup></p>

<div class="example"><a name="d6e171"></a><p class="title"><b>Example&nbsp;11.&nbsp;Transclusion of document which contains further references</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Sample book<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"article.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"shared-texts.002.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Sample book<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:ta</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/xslt/ns/transclusion-annotation"</span>
    <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/article.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Sample article<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Leading text<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;section</strong> <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/module.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Module which is going to be shared across several documents<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Bla bla bla<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/section&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;article</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:ta</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/xslt/ns/transclusion-annotation"</span>
    <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/shared-texts.002.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;info&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Transclusions demo<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;author&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;personname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;firstname&gt;</strong>Jirka<strong class="hl-tag" style="color: #000096">&lt;/firstname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;surname&gt;</strong>Kosek<strong class="hl-tag" style="color: #000096">&lt;/surname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/personname&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/author&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/info&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This article was written by
          <strong class="hl-tag" style="color: #000096">&lt;personname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;firstname&gt;</strong>Jirka<strong class="hl-tag" style="color: #000096">&lt;/firstname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;surname&gt;</strong>Kosek<strong class="hl-tag" style="color: #000096">&lt;/surname&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/personname&gt;</strong> when there
      was 25C outside.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/article&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
</div></div><br class="example-break">

</div>

<div class="section" title="Special ID/IDREF processing"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d6e180"></a>Special ID/IDREF processing</h2></div></div></div>


<p>Transcluded content can contain an <code class="sgmltag-attribute">xml:id</code> attributes. If one fragment is
transcluded more then once then the resulting document after transclusion will
contain duplicate IDs. The same problem may arise if IDs are colliding in
transcluded modules. To overcome this problem all IDs and references
to them can be adjusted during the transclusion process.</p>

<p>If there is <code class="sgmltag-attribute">xml:id</code> attribute present
on the <code class="sgmltag-element">ref</code> element, then this ID will replace <code class="sgmltag-attribute">xml:id</code> on the outermost element of any transcluded
content. It is an error to transclude content which is not enclosed in
a single element and specifying an <code class="sgmltag-attribute">xml:id</code>
attribute on <code class="sgmltag-element">ref</code> element at the same time.</p>

<p>How IDs are going to be adjusted during transclusion is
controlled by the <code class="sgmltag-attribute">idfixup</code> attribute on
the <code class="sgmltag-element">ref</code> element. It can have one of the following
values.</p>

<div class="variablelist"><dl><dt><span class="term"><code class="sgmltag-attvalue">none</code></span></dt><dd><p>No ID adjustment is done</p></dd><dt><span class="term"><code class="sgmltag-attvalue">strip</code></span></dt><dd><p>All IDs are stripped (except <code class="sgmltag-attribute">xml:id</code> inherited from <code class="sgmltag-element">ref</code> element)</p></dd><dt><span class="term"><code class="sgmltag-attvalue">prefix</code></span></dt><dd><p>All IDs are prefixed with a value specified in <code class="sgmltag-attribute">prefix</code> attribute</p></dd><dt><span class="term"><code class="sgmltag-attvalue">auto</code></span></dt><dd><p>All IDs are prefixed with a value which is unique for
each <code class="sgmltag-element">ref</code> element<sup>[<a name="d6e218" href="#ftn.d6e218" class="footnote">2</a>]</sup></p>
<p>This is default behavior if attribute is not specified.</p></dd></dl></div>

<p>Of course if IDs are adjusted then all corresponding references has
to be also corrected. This is controlled by <code class="sgmltag-attribute">linkscope</code> attribute. It can have one of the
following values.</p>

<div class="variablelist"><dl><dt><span class="term"><code class="sgmltag-attvalue">user</code></span></dt><dd><p>No IDREF adjustment is done</p></dd><dt><span class="term"><code class="sgmltag-attvalue">local</code></span></dt><dd><p>All IDREFs in transcluded content are prefixed by user
specified prefix (when <code class="literal">idfixup="prefix"</code>) or
auto-generated prefix (when <code class="literal">idfixup="auto"</code>).</p>
<p>Using this value with other <code class="sgmltag-attribute">idfixup</code>
values is an error.<em><span class="remark">Maybe raising error is to strict approach.</span></em></p></dd><dt><span class="term"><code class="sgmltag-attvalue">near</code></span></dt><dd><p>All IDREFs in transcluded content are adjusted to
point to the closest element which has a matching ID. A matching ID
doesn't mean string equality between ID and IDREF values &#8211; it is
sufficient if second part of ID and IDREF after removal of
possibly added prefixes is matching.</p>
<p>When searching for the closest element ancestor elements of
an element with an IDREF attribute are gradually inspected and matching ID
is searched between all their descendants. If there is no matching ID, then
parent is inspected and so on until match is found or document root is
reached.</p></dd><dt><span class="term"><code class="sgmltag-attvalue">global</code></span></dt><dd><p>All IDREFs in transcluded content are adjusted to
point to the first element in document order which has a matching ID. A matching ID
doesn't mean string equality between ID and IDREF values &#8211; it is
sufficient if the second part of ID and IDREF after removal of
possibly added prefixes are matching.</p>
</dd></dl></div>

<p>By using various combinations of <code class="sgmltag-attribute">idfixup</code> and <code class="sgmltag-attribute">linkscope</code> attributes we can achieve different
linking behavior. The following examples show the effect of using those two
attributes. Examples are transcluding the following procedure which
contains one internal link and one external (points to target outside
of this module).</p>

<div class="example"><a name="d6e255"></a><p class="title"><b>Example&nbsp;12.&nbsp;Module with sample procedure</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"paper-insert"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners.
    If you don't have printer, consider <b style="color: navy">&lt;link</b> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>  
  <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>

</pre>
</div></div><br class="example-break">

<p>Now lets assume that we want to transclude this module twice to
show how we can deal with duplicate IDs problem.</p>

<div class="example"><a name="d6e261"></a><p class="title"><b>Example&nbsp;13.&nbsp;Automatic ID/IDREF adjustment</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e36---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>
</pre>
<p>We haven't specified <code class="sgmltag-attribute">idfixup</code> and
<code class="sgmltag-attribute">linkscope</code> attributes so the default behavior
is triggered. All IDs in transcluded modules are automatically
prefixed to prevent ID collisions. Then IDREFs are fixed so that links
point to the nearest possible target. For example the link from step 2 to
step 1 in procedure always points to the same instance of
procedure. However <span class="quote">&#8220;<span class="quote">buy</span>&#8221;</span> link is pointing correctly to target in
the main document.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e274"></a><p class="title"><b>Example&nbsp;14.&nbsp;Global linkscope</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">linkscope</span>=<span class="hl-value" style="color: #993300">"global"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>
</pre>
<p>We used <code class="literal">linkscope="global"</code> on the second
transclusion. Result is that link from step 2 in the second procedure
now links to step 1 in the first procedure.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e285"></a><p class="title"><b>Example&nbsp;15.&nbsp;Local linkscope</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">linkscope</span>=<span class="hl-value" style="color: #993300">"local"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e36---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e36---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>We used <code class="literal">linkscope="local"</code> on the first
transclusion. This means that no link from this transclusion can point
outside of this transclusion. Because there was such link
(<span class="quote">&#8220;<span class="quote">buy</span>&#8221;</span> link), thus the result of transclusion is broken because
there is no corresponding target for IDREF
<code class="literal">d2e22---buy</code>.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e298"></a><p class="title"><b>Example&nbsp;16.&nbsp;Manually assigned prefix</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"install-proc"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">prefix</span>=<span class="hl-value" style="color: #993300">"install-proc_"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"maintain-proc"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">prefix</span>=<span class="hl-value" style="color: #993300">"maintain-proc_"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"install-proc_paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"install-proc_s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong>
            <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"install-proc_s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"maintain-proc_paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"maintain-proc_s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong>
            <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"maintain-proc_s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>
</pre>
<p>If we care about the resulting IDs after transclusion we can
manually assign some meaningful prefix before IDs in transcluded document.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e308"></a><p class="title"><b>Example&nbsp;17.&nbsp;Disabling ID fixup</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"none"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"none"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>We have disabled ID fixup by
<code class="literal">idfixup="none"</code>. The resulting document thus contain
duplicated IDs.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e319"></a><p class="title"><b>Example&nbsp;18.&nbsp;Stripping IDs</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"strip"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"d2e22---s1"</span><strong class="hl-tag" style="color: #000096">
          /&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>We have stripped all IDs from the second transcluded procedure by
<code class="literal">idfixup="strip"</code>. Thus there are no duplicate IDs in
the resulting document and links from second procedure always target
first one. However IDs in the first procedure were automatically
prefixed.</p>
</div></div><br class="example-break">

<div class="example"><a name="d6e330"></a><p class="title"><b>Example&nbsp;19.&nbsp;Retaining original IDs</b></p><div class="example-contents">

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"none"</span> <span class="hl-attribute" style="color: #F5844C">linkscope</span>=<span class="hl-value" style="color: #993300">"user"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;ref</strong> <span class="hl-attribute" style="color: #F5844C">fileref</span>=<span class="hl-value" style="color: #993300">"procedure.001.xml"</span> <span class="hl-attribute" style="color: #F5844C">idfixup</span>=<span class="hl-value" style="color: #993300">"strip"</span> <span class="hl-attribute" style="color: #F5844C">linkscope</span>=<span class="hl-value" style="color: #993300">"user"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>Result of transclusion:</p>
<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<strong class="hl-tag" style="color: #000096">&lt;book</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <b style="color: navy">&lt;title&gt;</b>Definitive Printer Guide<b style="color: navy">&lt;/title&gt;</b>
  <strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"buy"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Buying printer<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Grab money, go to shop, ...<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Quick installation guide<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Carefully follow all procedures bellow.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"paper-insert"</span>
      <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;chapter&gt;</strong>
    <b style="color: navy">&lt;title&gt;</b>Maintenance<b style="color: navy">&lt;/title&gt;</b>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Be friendly to your printer when you speak to it.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>If green led is blinking, please add missing paper using the following procedure.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;procedure</strong> <span class="hl-attribute" style="color: #F5844C">xml:base</span>=<span class="hl-value" style="color: #993300">"file:/e:/texts/docbook/tc/transclusions/procedure.001.xml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <b style="color: navy">&lt;title&gt;</b>Inserting paper into printer<b style="color: navy">&lt;/title&gt;</b>
      <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>This procedure is targeted to printer owners. If you don't have printer, consider <b style="color: navy">&lt;link</b>
          <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"buy"</span><b style="color: navy">&gt;</b>buying one<b style="color: navy">&lt;/link&gt;</b>.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Make sure that you have paper.<strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;step&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;para&gt;</strong>Insert paper into printer. If you don't have paper consult <strong class="hl-tag" style="color: #000096">&lt;xref</strong> <span class="hl-attribute" style="color: #F5844C">linkend</span>=<span class="hl-value" style="color: #993300">"s1"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/para&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/step&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/procedure&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/chapter&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/book&gt;</strong>

</pre>
<p>We have stripped all IDs from the second transcluded procedure by
<code class="literal">idfixup="strip"</code>. Thus there are no duplicate IDs in
the resulting document and links from second procedure always target
first one. IDs in the first procedure were not automatically prefixed
since we have specified <code class="literal">idfixup="none"</code>.</p>
</div></div><br class="example-break">

<p class="remark"><em><span class="remark">Should be there option to preserve original IDs (without
prefix) in output when doing prefixes?</span></em></p>

</div>

<div class="section" title="Transformations"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d6e343"></a>Transformations</h2></div></div></div>


<p class="remark"><em><span class="remark">FIXME: This should provide some very generic mechanism for
applying various transformations on referenced content before actual
transclusion. For example DITA -&gt; DocBook, V4.x -&gt; V5.0 conversion and
so on.</span></em></p>

<p>FIXME: TC decided this is not in scope of transclusions. Sources should
be prepared in advance.</p>

</div>

<div class="section" title="Evaluation"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d6e347"></a>Evaluation</h2></div></div></div>


<p>The above DocBook transclusion proposal solves all
<a class="ulink" href="http://docbook.org/docs/transclusion-requirements/" target="_top">use
cases</a> except <a class="ulink" href="http://docbook.org/docs/transclusion-requirements/#uc-2" target="_top">UC-2</a>. Transclusions
are more usable and can solve various problems introduced by multiple
inclusion of the same content. Some of those problems can be solved by
using XInclude &#8211; but syntax is cumbersome and there is no good
interoperability between various XInclude implementations.</p>

<p>For the above reasons I think that transclusions should be
added into core DocBook. I don't think that making them separate XML
transclusion standard is viable approach. A transclusion processor has
to know which attributes are of ID/IDREF type for each document
type. History shown that generic standards  relying on access to
a schema are not successful.</p>

</div>

<div class="appendix" title="A.&nbsp;DocBook schema with support for transclusions"><h2 class="title" style="clear: both"><a name="d6e353"></a>A.&nbsp;DocBook schema with support for transclusions</h2>


<pre class="programlisting">
# TODO
# - use DocBook schema coding style

default namespace db = "http://docbook.org/ns/docbook"

include "docbook.rnc"

# element for referencing content
db.ref = 
  element ref { 
    (db.ref.inline | db.ref.external)
  }

# common content
db.ref.common =
  db.effectivity.attributes,
  attribute xml:id { xsd:ID }?,
  attribute linkscope { "user" | "local" | "near" | "global"}?,
  attribute idfixup { "none" | "strip" | "prefix" | "auto" }?,
  attribute prefix { xsd:NCName }?,
  (db.transform*)

# inline content is grabed from local definitions or from external definitions file
db.ref.inline =
  attribute definitionfile { xsd:anyURI }?,
  attribute name { xsd:NCName },
  db.ref.common

# content from external sources
db.ref.external =
  attribute fileref { xsd:anyURI },
  attribute xpointer { text }?,
  attribute encoding { text }?,
  attribute parse { "xml" | "text" }?,
  db.ref.common
  
# FIXME: specify all kinds of possible transformations
db.transform = empty  

# element for defitions
db.definitions =
  element definitions {
    attribute definitionfile { xsd:anyURI }?,
    db.def*
  }
  
# single definition
db.def = 
  element def {
    attribute name { xsd:NCName },
    db.effectivity.attributes,
    (text &amp; db._any*)
  }
  
# hooks into standard schema

# allow references to appear almost everywhere
db.ubiq.inlines |= db.ref*

db.divisions |= db.ref
db.components |= db.ref

db.toplevel.sections |=
   (db.section|db.ref)+ | (db.simplesect|db.ref)+

db.recursive.sections |=
   (db.section|db.ref)+ | (db.simplesect|db.ref)+

db.part.components |= db.ref

db.reference.components |= db.ref

db.all.blocks |= db.ref

db.info.elements |= db.ref

# definitions can be only inside info elements
db.info.elements |= db.definitions

# or they can be provided in a separate file
start |= db.definitions


</pre>

<p class="remark"><em><span class="remark">Should we allow multiple file references in @definitionfile?</span></em></p>

<p class="remark"><em><span class="remark">Should we allow <span>ref</span> inside <span>def</span>?
(Probably yes).</span></em></p>

</div>

<div class="appendix" title="B.&nbsp;Sample transclusion processor written in XSLT 2.0"><h2 class="title" style="clear: both"><a name="d6e362"></a>B.&nbsp;Sample transclusion processor written in XSLT 2.0</h2>


<p>Please note that this sample transclusion processor is not yet
feature complete. It supports only subset of proposal.</p>

<pre class="programlisting">
<span class="hl-directive" style="color: maroon">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<strong style="color: #0066FF">&lt;xsl:stylesheet</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"2.0"</span>
		<span class="hl-attribute" style="color: #F5844C">xmlns:f</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/xslt/ns/extension"</span>
		<span class="hl-attribute" style="color: #F5844C">xmlns:mp</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/xslt/ns/mode/private"</span>
		<span class="hl-attribute" style="color: #F5844C">xmlns:db</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/ns/docbook"</span>
		<span class="hl-attribute" style="color: #F5844C">xmlns:xs</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema"</span>
		<span class="hl-attribute" style="color: #F5844C">xmlns:ta</span>=<span class="hl-value" style="color: #993300">"http://docbook.org/xslt/ns/transclusion-annotation"</span>
		<span class="hl-attribute" style="color: #F5844C">exclude-result-prefixes</span>=<span class="hl-value" style="color: #993300">"f mp xs"</span><strong style="color: #0066FF">&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"/"</span><strong style="color: #0066FF">&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"expanded"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:expand-definitions(/)"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"resolved"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:resolve-references($expanded)"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:adjust-idrefs($resolved)"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$result"</span><strong style="color: #0066FF">/&gt;</strong>

<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<em class="hl-comment" style="color: silver">&lt;!-- Separator for auto generated prefixes --&gt;</em>
<strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"psep"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'---'"</span><strong style="color: #0066FF">/&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:transclude"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"doc"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"expanded"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:expand-definitions($doc)"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"resolved"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:resolve-references($expanded)"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$resolved"</span><strong style="color: #0066FF">/&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:expand-definitions"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"doc"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$doc"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:expand-definitions"</span><strong style="color: #0066FF">/&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"node()"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:expand-definitions"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@*"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:expand-definitions"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"db:definitions[@definitionfile]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:expand-definitions"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:expand-definitions(doc(@definitionfile))"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@* except @definitionfile"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:expand-definitions"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:resolve-references"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"doc"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$doc"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">/&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"node()"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idfixup"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'auto'"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@* except @xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:if</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"@xml:id"</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"($idfixup = 'none') or @ta:linkscope"</span><strong style="color: #0066FF">&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'strip'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:id"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat($prefix, @xml:id)"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:if&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:with-param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if (@ta:linkscope) then '' else $prefix"</span><strong style="color: #0066FF">/&gt;</strong>   <em class="hl-comment" style="color: silver">&lt;!-- Prevent adding several prefixes on multi-level inclusions --&gt;</em>
    <strong style="color: #0066FF">&lt;/xsl:apply-templates&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<em class="hl-comment" style="color: silver">&lt;!-- FIMXE: this stripping is there just to have more compact output --&gt;</em>
<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"db:definitions"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span> <span class="hl-attribute" style="color: #F5844C">priority</span>=<span class="hl-value" style="color: #993300">"1"</span><strong style="color: #0066FF">&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"db:ref[@name]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"name"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@name"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"content"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"@definitionfile"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"defs"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:expand-definitions(doc(@definitionfile))"</span><strong style="color: #0066FF">/&gt;</strong>

	<strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$defs/db:def[@name = $name]"</span><strong style="color: #0066FF">&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"($defs/db:def[@name = $name])[last()]/node()"</span><strong style="color: #0066FF">/&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:message&gt;</strong>Error: definition of "<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$name"</span><strong style="color: #0066FF">/&gt;</strong>" was not found.<strong style="color: #0066FF">&lt;/xsl:message&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:definition-for-name(@name, .)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:variable&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idfixup"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if (@idfixup) then @idfixup else 'auto'"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"linkscope"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if (@linkscope) then @linkscope else 'near'"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'auto'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat(generate-id(.), $psep)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'prefix'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"string(@prefix)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong><strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:variable&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ref-xmlid"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@xml:id"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:if</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"count($content/(*|text()[normalize-space(.) ne ''])) &gt; 1 and $ref-xmlid"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:message&gt;</strong>Error xml:id can't be added to definition without single outermost element.<strong style="color: #0066FF">&lt;/xsl:message&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:if&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:for-each</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$content/node()"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xmlid"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if ($ref-xmlid) then $ref-xmlid else @xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@* except @xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:if</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"self::*"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'none' and $xmlid"</span><strong style="color: #0066FF">&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:id"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$xmlid"</span><strong style="color: #0066FF">/&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"($idfixup = 'strip' and not($ref-xmlid)) or not($xmlid)"</span><strong style="color: #0066FF">&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:id"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat($prefix, @xml:id)"</span><strong style="color: #0066FF">/&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
	<em class="hl-comment" style="color: silver">&lt;!-- &lt;xsl:attribute name="xml:base" select="$baseuri"/&gt; --&gt;</em>
	<strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ta:linkscope"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$linkscope"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ta:prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$prefix"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:if&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:with-param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idfixup"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$idfixup"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:with-param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$prefix"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:apply-templates&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:for-each&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:definition-for-name"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()*"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"name"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"context"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"closest-info-with-defs"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$context/ancestor-or-self::*/db:info[db:definitions][1]"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$closest-info-with-defs"</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$closest-info-with-defs/db:definitions/db:def[@name = $name]"</span><strong style="color: #0066FF">&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"($closest-info-with-defs/db:definitions/db:def[@name = $name])[last()]/node()"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:definition-for-name($name, $closest-info-with-defs/../..)"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:message&gt;</strong>Error: definition of "<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$name"</span><strong style="color: #0066FF">/&gt;</strong>" was not found.<strong style="color: #0066FF">&lt;/xsl:message&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"db:ref[@parse eq 'text']"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"@encoding"</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"unparsed-text(@fileref, @encoding)"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"unparsed-text(@fileref)"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>


<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"db:ref[@fileref and (@parse eq 'xml' or not(@parse))]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"doc"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"@xpointer"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:transclude(doc(@fileref)//*[@xml:id = current()/@xpointer])"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:transclude(doc(@fileref))"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:variable&gt;</strong>
  
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"baseuri"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"resolve-uri(@fileref, base-uri(.))"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idfixup"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if (@idfixup) then @idfixup else 'auto'"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"linkscope"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if (@linkscope) then @linkscope else 'near'"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'auto'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat(generate-id(.), $psep)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'prefix'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"string(@prefix)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong><strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:variable&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ref-xmlid"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@xml:id"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:for-each</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$doc/node()"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xmlid"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if ($ref-xmlid) then $ref-xmlid else @xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@* except @xml:id"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:if</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"self::*"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$idfixup = 'none' and $xmlid"</span><strong style="color: #0066FF">&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:id"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$xmlid"</span><strong style="color: #0066FF">/&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"($idfixup = 'strip' and not($ref-xmlid)) or not($xmlid)"</span><strong style="color: #0066FF">&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
	  <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
	    <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:id"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat($prefix, @xml:id)"</span><strong style="color: #0066FF">/&gt;</strong>
	  <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
	<strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"xml:base"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$baseuri"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ta:linkscope"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$linkscope"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"ta:prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$prefix"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:if&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:transclude"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:with-param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idfixup"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$idfixup"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:with-param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$prefix"</span> <span class="hl-attribute" style="color: #F5844C">tunnel</span>=<span class="hl-value" style="color: #993300">"yes"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:apply-templates&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:copy-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"following-sibling::node()"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:for-each&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:adjust-idrefs"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"doc"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()+"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$doc"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:adjust-idrefs"</span><strong style="color: #0066FF">/&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"node()|@*"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:adjust-idrefs"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:copy&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:apply-templates</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"@* | node()"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:adjust-idrefs"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:copy&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<em class="hl-comment" style="color: silver">&lt;!-- FIXME: add support for @linkends, @zone, @arearefs --&gt;</em>
<em class="hl-comment" style="color: silver">&lt;!-- FIEMX: add support for xlink:href starting with # --&gt;</em>
<strong style="color: #0066FF">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">"@linkend | @endterm | @otherterm | @startref"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"mp:adjust-idrefs"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idref"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"."</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"annotation"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"ancestor-or-self::*[@ta:linkscope][1]"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"linkscope"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"($annotation/@ta:linkscope, 'near')[1]"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$annotation/@ta:prefix"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:attribute</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"{local-name(.)}"</span><strong style="color: #0066FF">&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$linkscope = 'user'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$idref"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$linkscope = 'local'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"concat($prefix, $idref)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$linkscope = 'near'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:nearest-matching-id($idref, ..)"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$linkscope = 'global'"</span><strong style="color: #0066FF">&gt;</strong>
	<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:nearest-matching-id($idref, root(.))"</span><strong style="color: #0066FF">/&gt;</strong>
      <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:attribute&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:template&gt;</strong>

<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:nearest-matching-id"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string?"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"idref"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"context"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()"</span><strong style="color: #0066FF">/&gt;</strong>

  <em class="hl-comment" style="color: silver">&lt;!-- FIXME: key() requires document-node() rooted subtree --&gt;</em>
  <em class="hl-comment" style="color: silver">&lt;!--  &lt;xsl:variable name="targets" select="key('unprefixed-id', f:unprefixed-id($idref, $context), $context)"/&gt; --&gt;</em>
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"targets"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$context//*[@xml:id][f:unprefixed-id(@xml:id, .) eq f:unprefixed-id($idref, $context)]"</span><strong style="color: #0066FF">/&gt;</strong> 

  <strong style="color: #0066FF">&lt;xsl:choose&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"not($targets) and $context/.."</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"f:nearest-matching-id($idref, $context/..)"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:when</strong> <span class="hl-attribute" style="color: #F5844C">test</span>=<span class="hl-value" style="color: #993300">"$targets"</span><strong style="color: #0066FF">&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$targets[1]/string(@xml:id)"</span><strong style="color: #0066FF">/&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:when&gt;</strong>
    <strong style="color: #0066FF">&lt;xsl:otherwise&gt;</strong>
      <strong style="color: #0066FF">&lt;xsl:message&gt;</strong>Error: no matching ID for reference "<strong style="color: #0066FF">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$idref"</span><strong style="color: #0066FF">/&gt;</strong>" was found.<strong style="color: #0066FF">&lt;/xsl:message&gt;</strong>
    <strong style="color: #0066FF">&lt;/xsl:otherwise&gt;</strong>
  <strong style="color: #0066FF">&lt;/xsl:choose&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<em class="hl-comment" style="color: silver">&lt;!-- FIXME: type annotation should be without ?, find why it is called with empty sequence --&gt;</em>
<strong style="color: #0066FF">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"f:unprefixed-id"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string?"</span><strong style="color: #0066FF">&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"id"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string?"</span><strong style="color: #0066FF">/&gt;</strong>
  <strong style="color: #0066FF">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"context"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"node()"</span><strong style="color: #0066FF">/&gt;</strong>
  
  <strong style="color: #0066FF">&lt;xsl:variable</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prefix"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$context/ancestor-or-self::*[@ta:prefix][1]/@ta:prefix"</span><strong style="color: #0066FF">/&gt;</strong>

  <strong style="color: #0066FF">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"if ($prefix) then substring-after($id, $prefix) else $id"</span><strong style="color: #0066FF">/&gt;</strong>
<strong style="color: #0066FF">&lt;/xsl:function&gt;</strong>

<em class="hl-comment" style="color: silver">&lt;!--
&lt;xsl:key name="unprefixed-id" match="*[@xml:id]" use="f:unprefixed-id(@xml:id, .)"/&gt;
--&gt;</em>

<strong style="color: #0066FF">&lt;/xsl:stylesheet&gt;</strong>
</pre>

</div>

<div class="appendix" title="C.&nbsp;Mapping Transclusions to XInclude"><h2 class="title" style="clear: both"><a name="d6e368"></a>C.&nbsp;Mapping Transclusions to XInclude</h2>


<p>Some basic functionality of transclusions can be directly mapped
into XInclude as show in the table below. However there are still some
very important features which can't be replicated with pure XInclude,
namely:</p>

<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>ID/IDREF fixup &#8211; it was one of the most important
requirements to provide solution to the duplicate IDs problem;</p></li><li class="listitem"><p>profiling &#8211; it's not possible to specify profiling
attributes on <code class="sgmltag-element">xi:include</code> element as it is subject to
special handling;</p></li><li class="listitem"><p>changing ID during transclusion &#8211; it's not possible to
specify new xml:id value for transcluded content on
<code class="sgmltag-element">xi:include</code> element as it is subject to special
handling;</p></li><li class="listitem"><p>redefinitions are not supported. Having more
definitions in one file will lead to an invalid file as each definition
has to be identified by an unique <code class="sgmltag-attribute">xml:id</code>.</p></li></ul></div>

<div class="table"><a name="d6e383"></a><p class="title"><b>Table&nbsp;C.1.&nbsp;Mapping Transclusions to XInclude</b></p><div class="table-contents">

<table summary="Mapping Transclusions to XInclude" border="1"><colgroup><col width="33%"><col width="33%"><col width="34%"></colgroup><thead><tr><th>Transclusion construct</th><th>XInclude equivalent</th><th>Note</th></tr></thead><tbody><tr valign="top"><td valign="top"><code class="code">&lt;ref name="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top"><code class="code">&lt;xi:include xpointer="xpath(id(<em class="replaceable"><code>foo</code></em>)/node())"/&gt;</code></td><td valign="top">XInclude implementations are not required to support missing
<code class="sgmltag-attribute">href</code> attribute. See <a class="ulink" href="http://www.w3.org/TR/xinclude/#include-location" target="_top">http://www.w3.org/TR/xinclude/#include-location</a></td></tr><tr valign="top"><td valign="top"><code class="code">&lt;ref definitionfile="<em class="replaceable"><code>bar</code></em>" name="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top"><code class="code">&lt;xi:include href="<em class="replaceable"><code>bar</code></em>" xpointer="xpath(id(<em class="replaceable"><code>foo</code></em>)/node())"/&gt;</code></td><td valign="top">&nbsp;</td></tr><tr valign="top"><td valign="top"><code class="code">&lt;ref fileref="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top"><code class="code">&lt;xi:include href="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top">&nbsp;</td></tr><tr valign="top"><td valign="top"><code class="code">&lt;definitions definitionfile="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top"><code class="code">&lt;xi:include href="<em class="replaceable"><code>foo</code></em>"/&gt;</code></td><td valign="top">DocBook schema and stylesheets has to be modified to ignore
elements which are inserted only for further referencing.</td></tr><tr valign="top"><td valign="top"><code class="code">&lt;def name="<em class="replaceable"><code>foo</code></em>"&gt;&#8230;&lt;/def&gt;</code></td><td valign="top"><code class="code">&lt;phrase xml:id="<em class="replaceable"><code>foo</code></em>"&gt;&#8230;&lt;/phrase&gt;</code></td><td valign="top">Any generic DocBook element can be used instead of
<code class="sgmltag-element">phrase</code>. Element itself is not transcluded.</td></tr></tbody></table>
</div></div><br class="table-break">

<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
<p>Please note that <code class="literal">xpath()</code> XPointer scheme is
not widely supported. Formerly <code class="literal">xpointer()</code> schema
was popular although it's standardization was never finished. Later on
<code class="literal">xpath()</code> schema appeared in the list of registered
schemes <a class="ulink" href="http://www.w3.org/2005/04/xpointer-schemes/" target="_top">http://www.w3.org/2005/04/xpointer-schemes/</a>. Today two
special schemes exists &#8211; <code class="literal">xpath1()</code> and
<code class="literal">xpath2()</code> &#8211; for respective versions of XPath
language.</p>
</div>

</div>

<div class="appendix" title="D.&nbsp;Alternative proposal from Hussein Shafie"><h2 class="title" style="clear: both"><a name="d6e445"></a>D.&nbsp;Alternative proposal from Hussein Shafie</h2>


<p>This appendix summarizes points made in the following email
<a class="ulink" href="http://lists.oasis-open.org/archives/docbook/201012/msg00014.html" target="_top">http://lists.oasis-open.org/archives/docbook/201012/msg00014.html</a>.</p>

<p>Any element may bear one of these two attributes: <code class="sgmltag-attribute">ref</code> and <code class="sgmltag-attribute">copy</code>. The
value of these attributes is an URL, possibly ending with a
fragment.</p>

<p>When an element has a <code class="sgmltag-attribute">ref</code> or a <code class="sgmltag-attribute">copy</code> attribute, it must be completely
empty.</p>

<div class="section" title="&#8220;Compose&#8221; transclusion directive"><div class="titlepage"><div><div><h3 class="title"><a name="d6e455"></a><span class="quote">&#8220;<span class="quote">Compose</span>&#8221;</span> transclusion directive</h3></div></div></div>


<p><code class="sgmltag-attribute">ref</code> is a <span class="quote">&#8220;<span class="quote">compose</span>&#8221;</span>
transclusion directive. Examples:</p>

<pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;chapter</strong> <span class="hl-attribute" style="color: #F5844C">ref</span>=<span class="hl-value" style="color: #993300">"chapter1.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>

<strong class="hl-tag" style="color: #000096">&lt;section</strong> <span class="hl-attribute" style="color: #F5844C">ref</span>=<span class="hl-value" style="color: #993300">"book.xml#api_reference"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong></pre>

<p>When <code class="sgmltag-attribute">ref</code> attribute is used, there
is no ID/IDREF fixup in the transcluded content.</p>

</div>

<div class="section" title="&#8220;Instantiate a copy&#8221; transclusion directive"><div class="titlepage"><div><div><h3 class="title"><a name="d6e464"></a><span class="quote">&#8220;<span class="quote">Instantiate a copy</span>&#8221;</span> transclusion directive</h3></div></div></div>


<p><code class="sgmltag-attribute">copy</code> is an <span class="quote">&#8220;<span class="quote">instantiate a
copy</span>&#8221;</span> transclusion directive. Examples:</p>

<pre class="programlisting"><strong class="hl-tag" style="color: #000096">&lt;note</strong> <span class="hl-attribute" style="color: #F5844C">xml:id</span>=<span class="hl-value" style="color: #993300">"warning"</span> <span class="hl-attribute" style="color: #F5844C">copy</span>=<span class="hl-value" style="color: #993300">"common.xml#legal_warning"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>

<strong class="hl-tag" style="color: #000096">&lt;phrase</strong> <span class="hl-attribute" style="color: #F5844C">copy</span>=<span class="hl-value" style="color: #993300">"common.xml#product_name"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong></pre>

<p>When <code class="sgmltag-attribute">copy</code> attribute is used, there
is an automatic ID/IDREF fixup in the transcluded content, the one
described above:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Add a globally unique suffix to each ID defined in the copy.</p></li><li class="listitem"><p>Update the IDREF/IDREFS which point to these IDs.</p></li><li class="listitem"><p>Ignore the IDREF/IDREFS which point outside the copy.</p></li></ul></div>

</div>

<div class="section" title="Evaluation"><div class="titlepage"><div><div><h3 class="title"><a name="d6e480"></a>Evaluation</h3></div></div></div>


<p>Although very simple, this proposal covers many
use-cases. Although compared to the original proposal several features
are missing:</p>

<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>It is not possible to include just a text node, or
sequence of sibling nodes. Only one element (and its content) can
be transcluded at one time.</p></li><li class="listitem"><p>It is not possible to override definitions.</p></li><li class="listitem"><p>It is not possible to configure way in which ID fixup
is done.</p></li><li class="listitem"><p>Verbosity for including simple inline content is
similar to XInclude.</p></li></ul></div>

</div>

</div>

<div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a id="ftn.d6e168" href="#d6e168" class="para">1</a>] </sup>This effectively means
that it is not necessary to specify <code class="sgmltag-attribute">xml:lang</code> on each module.</p></div><div class="footnote"><p><sup>[<a id="ftn.d6e218" href="#d6e218" class="para">2</a>] </sup>For example XSLT based
implementations can use <code class="function">generate-id()</code> on
<code class="sgmltag-element">ref</code> element to generate such unique
prefix.</p></div></div></div></body></html>